---

---

<dialog
    id="language-modal"
    class="backdrop:bg-black/80 bg-transparent p-0 m-auto max-w-sm w-[90%] open:animate-fade-in backdrop:open:animate-fade-in"
>
    <div
        class="glass !bg-[#0B1221] border border-white/10 rounded-3xl p-8 relative overflow-hidden"
    >
        <!-- Close Button -->
        <button
            id="close-language-modal"
            class="absolute top-4 right-4 text-text-secondary hover:text-white transition-colors"
            aria-label="Close modal"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>

        <!-- Content -->
        <div class="text-center">
            <h2 class="text-2xl font-bold mb-6 text-white">Select Language</h2>

            <div class="space-y-4">
                <a
                    href="#"
                    class="block w-full glass hover:bg-white/10 border border-white/10 hover:border-primary text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 ease-in-out group lang-link"
                    data-lang="en"
                >
                    <span
                        class="group-hover:text-primary transition-colors duration-300"
                        >English</span
                    >
                </a>

                <a
                    href="#"
                    class="block w-full glass hover:bg-white/10 border border-white/10 hover:border-primary text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 ease-in-out group lang-link"
                    data-lang="de"
                >
                    <span
                        class="group-hover:text-primary transition-colors duration-300"
                        >Deutsch</span
                    >
                </a>
            </div>
        </div>
    </div>
</dialog>

<script>
    const initLanguageModal = () => {
        const dialog = document.getElementById(
            "language-modal",
        ) as HTMLDialogElement;
        const closeBtn = document.getElementById("close-language-modal");
        const triggers = document.querySelectorAll(".js-open-language");
        const langLinks = document.querySelectorAll(".lang-link");

        if (!dialog) return;

        // Open
        triggers.forEach((trigger) => {
            trigger.addEventListener("click", (e) => {
                e.preventDefault();
                dialog.showModal();
            });
        });

        // Close
        closeBtn?.addEventListener("click", () => {
            dialog.close();
        });

        // Close on backdrop click
        dialog.addEventListener("click", (e) => {
            const rect = dialog.getBoundingClientRect();
            const isInDialog =
                rect.top <= e.clientY &&
                e.clientY <= rect.top + rect.height &&
                rect.left <= e.clientX &&
                e.clientX <= rect.left + rect.width;

            if (!isInDialog) {
                dialog.close();
            }
        });

        // Handle Language Links (Smart Routing)
        langLinks.forEach((link) => {
            link.addEventListener("click", (e) => {
                e.preventDefault();
                const targetLang = link.getAttribute("data-lang");
                const currentPath = window.location.pathname;

                let newPath = "/";

                if (targetLang === "en") {
                    // Switch to English
                    if (currentPath.startsWith("/de")) {
                        newPath = currentPath.replace(/^\/de/, "") || "/";
                    } else {
                        newPath = currentPath; // Already English
                    }
                } else if (targetLang === "de") {
                    // Switch to German
                    if (!currentPath.startsWith("/de")) {
                        // Avoid double //
                        const path = currentPath === "/" ? "" : currentPath;
                        newPath = `/de${path}`;
                    } else {
                        newPath = currentPath; // Already German
                    }
                }

                window.location.href = newPath;
            });
        });
    };

    initLanguageModal();
    document.addEventListener("astro:page-load", initLanguageModal);
</script>

<style>
    /* Fad-in animation for dialog */
    dialog[open] {
        animation: fade-in 0.3s ease-out forwards;
    }

    dialog::backdrop {
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
    }

    @keyframes fade-in {
        from {
            opacity: 0;
            transform: scale(0.95);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
</style>
