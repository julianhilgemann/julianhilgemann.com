---
const navItems = [
    { name: "System", href: "/de/#services" },
    { name: "Projekte", href: "/de/#projects" },
    { name: "About", href: "/de/#about" },
];
---

<header
    class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 ease-in-out pointer-events-none"
>
    <!-- 
      Responsive Container:
      - w-[95%]: maintain margins on small mobile
      - max-w-2xl: consistent max width on desktop
      - px-4: adequate internal padding
    -->
    <div
        class="glass mx-auto mt-4 w-[calc(100%-2rem)] max-w-[1200px] rounded-full px-4 py-3 md:px-6 md:py-3 flex items-center justify-between pointer-events-auto shadow-sm"
    >
        <!-- Logo Area: Grow to push center -->
        <div class="flex flex-1 justify-start">
            <a
                href="/de"
                class="nav-link font-bold text-base md:text-lg tracking-tight hover:text-primary transition-colors duration-300 ease-in-out shrink-0"
                data-href="#hero"
            >
                JH
            </a>
        </div>

        <!-- 
          Navigation:
          - Always visible (removed hidden)
          - Tighter gap on mobile (gap-2.5) to fit
          - Smaller text on mobile (text-xs)
        -->
        <nav class="flex items-center gap-1.5 md:gap-8 shrink-0">
            {
                navItems.map((item, index) => (
                    <>
                        <a
                            href={item.href}
                            class="nav-link text-xs md:text-sm font-medium hover:text-primary transition-colors duration-300 ease-in-out"
                            data-href={item.href}
                        >
                            {item.name}
                        </a>
                        {index < navItems.length - 1 && (
                            <span
                                class="w-px h-3 bg-white/10 block"
                                aria-hidden="true"
                            />
                        )}
                    </>
                ))
            }
        </nav>

        <!-- 
          CTA:
          - Always visible
          - Compact padding/text on mobile
          - Prevent wrapping with whitespace-nowrap
        -->
        <div class="flex flex-1 justify-end items-center gap-4">
            <!-- Language Switcher -->
            <div class="relative group">
                <button
                    class="text-white hover:text-primary transition-colors duration-300 p-2 flex items-center justify-center shrink-0"
                    aria-label="Sprache wechseln"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path
                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1 4-10z"
                        ></path>
                    </svg>
                </button>
                <!-- Dropdown -->
                <div
                    class="absolute right-0 top-full mt-2 w-32 glass !bg-[#0B1221] border border-white/10 rounded-xl overflow-hidden invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-all duration-300 transform origin-top-right flex flex-col"
                >
                    <a
                        href={Astro.url.pathname.replace(/^\/de/, "") || "/"}
                        class="px-4 py-3 text-sm text-white hover:text-primary hover:bg-white/10 transition-colors"
                        >ENG</a
                    >
                    <a
                        href={Astro.url.pathname}
                        class="px-4 py-3 text-sm text-primary font-bold bg-white/5 cursor-default"
                        >GER</a
                    >
                </div>
            </div>

            <a
                href="#"
                class="glass hover:bg-white/10 text-white text-xs md:text-sm font-medium py-2 px-3 md:px-4 rounded-full transition-all duration-300 ease-in-out border !border-primary text-center whitespace-nowrap js-open-contact"
                data-location="header-cta"
            >
                Kontakt
            </a>
        </div>
    </div>
</header>

<script>
    const initScrollSpy = () => {
        const sections = document.querySelectorAll("section[id]");
        const navLinks = document.querySelectorAll(".nav-link");

        const observerOptions = {
            root: null,
            rootMargin: "-20% 0px -20% 0px", // Activate when section is in middle 60% of screen
            threshold: 0.2,
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute("id");

                    // Remove active class from all
                    navLinks.forEach((link) => {
                        link.classList.remove("text-primary");
                    });

                    // Add active class to corresponding link
                    // Match either data-href="#id" or data-href="/#id"
                    let activeLink = document.querySelector(
                        `.nav-link[data-href="#${id}"]`,
                    );
                    if (!activeLink) {
                        activeLink = document.querySelector(
                            `.nav-link[data-href="/de/#${id}"]`,
                        );
                    }

                    if (activeLink) {
                        activeLink.classList.add("text-primary");
                    }
                }
            });
        }, observerOptions);

        sections.forEach((section) => observer.observe(section));
    };

    // run on load
    initScrollSpy();
    // run on astro page swap
    document.addEventListener("astro:page-load", initScrollSpy);
</script>
