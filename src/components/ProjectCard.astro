---
interface Props {
    title: string;
    category: string;
    description: string;
    image: string;
    tags?: string[];
    content: string;
    link?: string;
}

const {
    title,
    category,
    description,
    image,
    tags = [],
    content,
    link,
} = Astro.props;
const id = title.replace(/\s+/g, "-").toLowerCase();
---

<div
    class="project-card group flex flex-col md:flex-row gap-6 md:gap-8 glass rounded-2xl p-6 hover:bg-white/10 transition-all duration-300 ease-in-out border border-white/5 items-start"
    id={`card-${id}`}
>
    <!-- Image -->
    <div
        class="w-full md:w-1/3 aspect-video md:aspect-[4/3] rounded-xl overflow-hidden shrink-0 relative"
    >
        <img
            src={image}
            alt={title}
            class="w-full h-full object-cover transition-transform duration-300 ease-in-out group-hover:scale-105"
        />
    </div>

    <!-- Content -->
    <div class="flex-1 min-w-0 w-full">
        <div class="flex justify-between items-start mb-4">
            <div>
                <span
                    class="text-xs font-bold tracking-wider text-info uppercase mb-1 block"
                    >{category}</span
                >
                <h3
                    class="text-2xl font-bold leading-tight group-hover:text-primary transition-colors duration-300 ease-in-out cursor-pointer js-toggle-trigger"
                >
                    {title}
                </h3>
            </div>

            <div class="flex items-center gap-4 shrink-0">
                {
                    link && (
                        <a
                            href={link}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 hover:bg-white/10 border border-white/10 text-xs font-medium text-text-secondary hover:text-primary transition-colors duration-300 ease-in-out group/link z-10"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                class="text-text-secondary group-hover/link:text-primary transition-colors duration-300 ease-in-out"
                            >
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" />
                            </svg>
                            Explore
                        </a>
                    )
                }
                <button
                    class="js-toggle-btn w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors duration-300 ease-in-out group-hover:text-primary border border-white/10"
                    aria-label="Expand details"
                    data-target={`content-${id}`}
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="transition-transform duration-300 ease-in-out transform js-icon"
                    >
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>
        </div>

        <div class="js-summary">
            <p class="text-text-secondary mb-6 line-clamp-3">
                {description}
            </p>

            <div class="flex flex-wrap gap-2 mb-6">
                {
                    tags.map((tag) => (
                        <span class="text-xs bg-white/5 px-2 py-1 rounded text-text-secondary border border-white/10">
                            {tag}
                        </span>
                    ))
                }
            </div>
        </div>

        <!-- Expanded Content -->
        <div
            id={`content-${id}`}
            class="js-content grid grid-rows-[0fr] opacity-0 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)]"
        >
            <div class="overflow-hidden">
                <div
                    class="pt-6 border-t border-white/10 prose prose-invert prose-sm max-w-none text-text-secondary"
                    set:html={content}
                />
            </div>
        </div>
    </div>
</div>

<script>
    function setupAccordion() {
        const triggers = document.querySelectorAll(".js-toggle-btn");
        const titleTriggers = document.querySelectorAll(".js-toggle-trigger");

        const toggle = (btn) => {
            const targetId =
                btn.getAttribute("data-target") ||
                `content-${btn.textContent.trim().replace(/\s+/g, "-").toLowerCase()}`;
            // Note: title doesn't have data-target standardly in my previous code?
            // Let's check the HTML. The button HAS data-target. The Title has class js-toggle-trigger but NO data-target attribute in the code I viewed.
            // Lines 47-51: <h3 class="... js-toggle-trigger"> {title} </h3>. No data-target.
            // But the button (Line 84) has data-target.
            // I should make sure the title click also works if I want it to. The previous code didn't handle title click!
            // Wait, line 136 select .js-toggle-btn. It didn't select .js-toggle-trigger.
            // So currently clicking title does NOTHING.
            // The user didn't ask to fix title clicking, but it has the cursor-pointer class. I should probably support it or just strictly follow instructions.
            // Instructions: "opening and closing the card a tad smoother".
            // I will stick to the button logic to avoid scope creep, but I need to make sure I don't break anything.

            // Re-reading JS: triggers = document.querySelectorAll(".js-toggle-btn");
            // So only button works.

            // Let's just update the loop for buttons as requested.
        };

        triggers.forEach((btn) => {
            btn.addEventListener("click", (e) => {
                e.preventDefault();
                const targetId = btn.getAttribute("data-target");
                // @ts-ignore
                const content = document.getElementById(targetId);
                const icon = btn.querySelector(".js-icon");

                if (content && icon) {
                    const isOpen =
                        content.classList.contains("grid-rows-[1fr]");

                    if (isOpen) {
                        // Close
                        content.classList.remove(
                            "grid-rows-[1fr]",
                            "opacity-100",
                        );
                        content.classList.add("grid-rows-[0fr]", "opacity-0");
                        icon.classList.remove("rotate-45");
                    } else {
                        // Open
                        content.classList.remove(
                            "grid-rows-[0fr]",
                            "opacity-0",
                        );
                        content.classList.add("grid-rows-[1fr]", "opacity-100");
                        icon.classList.add("rotate-45");
                    }
                }
            });
        });
    }

    // Run on load and page swap
    setupAccordion();
    document.addEventListener("astro:page-load", setupAccordion);
</script>
